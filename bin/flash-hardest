#!/usr/bin/env node
var stackBuffer = ''
process.stdin.setEncoding('utf8')
process.stdin.on('data', function (data) {
  stackBuffer += data
})

var f = require('../lib/module.js')
var program = require('commander')
var fs = require('fs')

program
  .version(require('../package.json').version)
  .description('Given a file (or JSON from STDIN), prints the hardest card (or hardest cards with -n)')
  .usage('[options] <file>')
  .option('-s, --spaces [number]', 'Number of spaces to indent the JSON [4]', '4')
  .option('-n, --count [number]', 'Number of cards to show [1]', '1')
  .parse(process.argv)

var spaces
// Allow users to get tab-indented JSON instead of space-indented JSON
if (program.spaces === '\t' || program.spaces === '\\t') {
  spaces = '\t'
} else {
  spaces = parseInt(program.spaces, 10)
}

var count = parseInt(program.count, 10)

if (program.args.length === 1) {
  var stack = JSON.parse(fs.readFileSync(program.args[0]))
  if (count === -1) {
    count = stack.length
  }
  var hardest = f.hardest(stack, count)
  console.log(JSON.stringify(hardest, null, spaces))
  process.exit()
} else {
  process.stdin.on('end', function () {
    var stack = JSON.parse(stackBuffer)
    if (count === -1) {
      count = stack.length
    }
    var hardest = f.hardest(stack, count)
    console.log(JSON.stringify(hardest, null, spaces))
    process.exit()
  })
}
